---
- name: "Run get_backup_swift_url.sh"
  ansible.builtin.script: ./get_backup_swift_url.sh
  register: result_get_backup_swift_url

- name: "Declare backup_swift_url to configure Cinder"
  set_fact:
    backup_swift_url: "{{ result_get_backup_swift_url.stdout_lines[-1] }}"




- name: Declare swift_url to configure cinder.conf
  set_fact:
    backup_swift_url: 

- name: A block to build Cinder for controller nodes
  block:
    - name: Include create_dbs/main.yml
      include_tasks: create_dbs/main.yml

    - name: Include create_services/main.yml
      include_tasks: create_services/main.yml

    - name: Include create_endpoints/main.yml
      include_tasks: create_endpoints/main.yml

    - name: Include install_packages/controllers/main.yml of cinder for controllers
      include_tasks: install_packages/controllers/main.yml

    - name: Include set_configuration/controllers/main.yml of cinder for controllers
      include_tasks: set_configuration/controllers/main.yml

    - name: Include cinder_manage_db_sync/main.yml for controllers
      include_tasks: cinder_manage_db_sync/main.yml

    # Get swift_url and transfer it to cinder node in order to configure cinder.conf on Cinder nodes.
    - name: Include get_backup_swift_url/main.yml
      include_tasks: get_backup_swift_url/main.yml
  when: "'controllers' in group_names"

- name: A block to build Cinder for cinder nodes
  block:
    - name: Include set_lvm/main.yml of cinder for controllers
      include_tasks: set_lvm/main.yml

    - name: Include install_packages/cinders/main.yml
      include_tasks: install_packages/cinders/main.yml

    - name: Include set_configuration/cinders/main.yml of cinder for controllers
      include_tasks: set_configuration/cinders/main.yml
  when: "'cinders' in group_names"
