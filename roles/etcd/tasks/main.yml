---
- name: Install packages for etcd
  apt:
    name:
      - etcd

- name: Get IP address from a hostname
  ansible.builtin.shell:
    cmd: getent hosts {{ inventory_hostname }} | cut -d ' ' -f 1
  register: ret_getent

- name: Declare a variable for IP address
  set_fact:
    ip_of_inventory_host: "{{ ret_getent.stdout_lines[0] }}"

- name: Create etcd config file
  ansible.builtin.template:
    src: etcd.j2
    dest: /etc/default/etcd
    owner: root
    group: root
    mode: '0644'
  register: etcd_config

- name: Restart etcd if its config files were modified
  ansible.builtin.systemd:
    state: restarted
    name: etcd
  when: etcd_config.changed

- name: etcd should be enabled
  ansible.builtin.systemd:
    enabled: yes
    name: etcd

