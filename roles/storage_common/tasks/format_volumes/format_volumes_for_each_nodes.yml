---
- name: Declare a group_name to format volumes
  set_fact:
    group_name: "{{ group_names[0] }}"

- name: Deeeeeeeeeeeeeeeeeeeeeeebug
  ansible.builtin.debug:
    msg: "inventory_hostname => {{ inventory_hostname }}, storage.swift => {{ aaa.storage.swift }}"
  loop_control:
    loop_var: aaa
  with_items: "{{ group_vars.hosts[group_name] }}"
  when: aaa.name == inventory_hostname

- name: Faaaaaaaaaaaaaaaaaaaaail
  ansible.builtin.fail:
    msg: "Faaaaaaaaaaaaaaaaaaaaail"



- name: Declare a variable for format_volumes.sh that create volumes for storage nodes.
  set_fact:
    options_of_format_volumes: []

- name: Declare type of format_volumes.sh
  set_fact:
    options_of_format_volumes: "{% if inventory_hostname | regex_search('^.*storage[0-9]+.*$') -%}
                                  {{ options_of_format_volumes + ['--type', 'storage'] }}
                                {% elif inventory_hostname | regex_search('^.*cinder[0-9]+.*$') -%}
                                  {{ options_of_format_volumes + ['--type', 'cinder'] }}
                                {% elif inventory_hostname | regex_search('^.*swift[0-9]+.*$') -%}
                                  {{ options_of_format_volumes + ['--type', 'swift'] }}
                                {% endif %}"

#- name: Declare options of devices for Swift nodes
#  with_items:


#- name: Declare options of devices for Cinder nodes
#  with: items

#- name: "Copy format_volumes.sh to \"/opt/format_volumes.sh\" on {{ inventory_hostname }}"
#  ansible.builtin.copy:
#    src: format_volumes.sh
#    dest: /opt/format_volumes.sh
#    owner: root
#    group: root
#    mode: '0750'

#- name: "Format volumes that has a role for storage (hostname={{ inventory_hostname }}, options={{ options_of_format_volumes }})"
#  ansible.builtin.script: ./format_volumes.sh {{ options_of_format_volumes }}
- name: "Format volumes that has a role for storage (hostname={{ inventory_hostname }}, options={{ options_of_format_volumes }})"
  ansible.builtin.script: ./format_volumes.sh {{ options_of_format_volumes | join(' ') }}


